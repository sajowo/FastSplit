<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#465BC7">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Rejestracja</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/test.css' %}">
    <link rel="stylesheet" href="{% static 'css/accessibility.css' %}">
    <link rel="stylesheet" href="{% static 'css/mobile.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-p7QstapH7YLAqVzR+C7kWgjHHwKVw3+wBzlnvjWorldIJYRtUknUIP0EjAnvCbxaayQvMsZ0MY3BWfBmuscZLSw=="
        crossorigin="anonymous">
</head>

<body>
    <div class="a11y-font-controls a11y-font-controls--fixed" role="group" aria-label="Rozmiar czcionki">
        <button type="button" class="a11y-font-btn" data-font-scale="0.85" aria-pressed="false"
            aria-label="Zmniejsz czcionkę">A-</button>
        <button type="button" class="a11y-font-btn" data-font-scale="1" aria-pressed="true"
            aria-label="Domyślny rozmiar">A</button>
        <button type="button" class="a11y-font-btn" data-font-scale="1.25" aria-pressed="false"
            aria-label="Zwiększ czcionkę">A+</button>
        <span class="a11y-separator"></span>
        <button type="button" class="a11y-contrast-btn" data-contrast-toggle aria-pressed="false"
            aria-label="Przełącz wysoki kontrast">◐</button>
    </div>

    <div class="registration-container">
        <form method="post" class="registration-form">

            {% csrf_token %}
            {{ form.media }}

            <div class="form-row">
                <div class="input-group">
                    <label>Imię</label>
                    <input type="text" name="first_name" required value="{{ form.first_name.value|default_if_none:'' }}"
                        placeholder="Np. Jan">
                    {% if form.first_name.errors %}
                    <div class="error-msg">{{ form.first_name.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="input-group">
                    <label>Nazwisko</label>
                    <input type="text" name="last_name" required value="{{ form.last_name.value|default_if_none:'' }}"
                        placeholder="Kowalski">
                    {% if form.last_name.errors %}
                    <div class="error-msg">{{ form.last_name.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="input-group full-width">
                <label>Adres Email</label>
                <input type="email" name="email" required value="{{ form.email.value|default_if_none:'' }}"
                    placeholder="jan.kowalski@poczta.pl">
                {% if form.email.errors %}
                <div class="error-msg">{{ form.email.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="form-row">
                <div class="input-group">
                    <label>Hasło</label>
                    <input type="password" name="password" id="password-input" required placeholder="••••••••">
                    {% if form.password.errors %}
                    <div class="error-msg">{{ form.password.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="input-group">
                    <label>Powtórz hasło</label>
                    <input type="password" name="password_confirm" id="password-confirm-input" required
                        placeholder="••••••••">
                    {% if form.password_confirm.errors %}
                    <div class="error-msg">{{ form.password_confirm.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>

            <!-- Wymagania hasła -->
            <div class="password-requirements" id="password-requirements">
                <div class="requirements-header">Wymagania hasła:</div>
                <ul class="requirements-list">
                    <li id="req-length" class="requirement">
                        <span class="req-icon">○</span>
                        <span>Minimum 8 znaków</span>
                    </li>
                    <li id="req-not-common" class="requirement">
                        <span class="req-icon">○</span>
                        <span>Nie może być zbyt popularne</span>
                    </li>
                    <li id="req-not-numeric" class="requirement">
                        <span class="req-icon">○</span>
                        <span>Nie może składać się tylko z cyfr</span>
                    </li>
                    <li id="req-not-similar" class="requirement">
                        <span class="req-icon">○</span>
                        <span>Nie może być podobne do danych osobowych</span>
                    </li>
                    <li id="req-match" class="requirement">
                        <span class="req-icon">○</span>
                        <span>Hasła muszą być identyczne</span>
                    </li>
                </ul>
            </div>

            <div class="captcha-container">
                {{ form.captcha }}
            </div>
            {% if form.captcha.errors %}
            <div class="error-msg" style="text-align: center;">Potwierdź, że nie jesteś robotem.</div>
            {% endif %}

            <div class="checkbox-group">
                <input type="checkbox" id="terms" name="terms" required>
                <label for="terms">
                    Akceptuję <a href="{% url 'terms' %}" class="link-accent">Regulamin</a> oraz <a
                        href="{% url 'terms' %}#privacy" class="link-accent">Politykę Prywatności</a> serwisu FastSplit.
                </label>
            </div>

            <button type="submit" class="submit-btn">Utwórz konto <i class="fas fa-arrow-right"></i></button>

            <div class="login-link">
                Masz już konto? <a href="{% url 'login' %}">Zaloguj się tutaj</a>
            </div>

            <div class="a11y-info-links">
                <a href="{% url 'faq' %}">FAQ</a>
                <span class="sep">•</span>
                <a href="{% url 'about' %}">O nas</a>
                <span class="sep">•</span>
                <a href="{% url 'terms' %}">Regulamin</a>
            </div>
        </form>
    </div>

    <script src="{% static 'js/accessibility.js' %}"></script>
    <script>
        (function () {
            const passwordInput = document.getElementById('password-input');
            const confirmInput = document.getElementById('password-confirm-input');
            const firstNameInput = document.querySelector('input[name="first_name"]');
            const lastNameInput = document.querySelector('input[name="last_name"]');
            const emailInput = document.querySelector('input[name="email"]');

            const reqLength = document.getElementById('req-length');
            const reqNotCommon = document.getElementById('req-not-common');
            const reqNotNumeric = document.getElementById('req-not-numeric');
            const reqNotSimilar = document.getElementById('req-not-similar');
            const reqMatch = document.getElementById('req-match');

            // Lista popularnych haseł (skrócona)
            const commonPasswords = [
                'password', '123456', '12345678', 'qwerty', 'abc123', 'monkey', 'master',
                'dragon', 'letmein', 'login', 'admin', 'welcome', 'password1', 'haslo',
                'haslo123', 'qwerty123', 'zaq12wsx', 'polska', 'warszawa', 'krakow'
            ];

            function setRequirement(element, passed) {
                const icon = element.querySelector('.req-icon');
                if (passed) {
                    element.classList.add('passed');
                    element.classList.remove('failed');
                    icon.textContent = '✓';
                } else {
                    element.classList.remove('passed');
                    element.classList.add('failed');
                    icon.textContent = '○';
                }
            }

            function validatePassword() {
                const password = passwordInput.value;
                const confirm = confirmInput.value;
                const firstName = firstNameInput ? firstNameInput.value.toLowerCase() : '';
                const lastName = lastNameInput ? lastNameInput.value.toLowerCase() : '';
                const email = emailInput ? emailInput.value.toLowerCase().split('@')[0] : '';

                // Min 8 znaków
                setRequirement(reqLength, password.length >= 8);

                // Nie popularne
                const isCommon = commonPasswords.some(common =>
                    password.toLowerCase().includes(common) || common.includes(password.toLowerCase())
                );
                setRequirement(reqNotCommon, password.length > 0 && !isCommon);

                // Nie tylko cyfry
                const isOnlyNumeric = /^\d+$/.test(password);
                setRequirement(reqNotNumeric, password.length > 0 && !isOnlyNumeric);

                // Nie podobne do danych osobowych
                const pwLower = password.toLowerCase();
                const isSimilar = (firstName && pwLower.includes(firstName) && firstName.length > 2) ||
                    (lastName && pwLower.includes(lastName) && lastName.length > 2) ||
                    (email && pwLower.includes(email) && email.length > 2);
                setRequirement(reqNotSimilar, password.length > 0 && !isSimilar);

                // Hasła identyczne
                setRequirement(reqMatch, password.length > 0 && confirm.length > 0 && password === confirm);
            }

            if (passwordInput && confirmInput) {
                passwordInput.addEventListener('input', validatePassword);
                confirmInput.addEventListener('input', validatePassword);
                if (firstNameInput) firstNameInput.addEventListener('input', validatePassword);
                if (lastNameInput) lastNameInput.addEventListener('input', validatePassword);
                if (emailInput) emailInput.addEventListener('input', validatePassword);
            }
        })();
    </script>
</body>

</html>